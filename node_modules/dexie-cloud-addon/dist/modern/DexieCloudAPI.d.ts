import { DexieCloudOptions } from './DexieCloudOptions';
import { DBRealmRole, DexieCloudSchema } from 'dexie-cloud-common';
import { UserLogin } from './db/entities/UserLogin';
import { PersistedSyncState } from './db/entities/PersistedSyncState';
import { SyncState } from './types/SyncState';
import { DXCUserInteraction } from './types/DXCUserInteraction';
import { DXCWebSocketStatus } from './DXCWebSocketStatus';
import { PermissionChecker } from './PermissionChecker';
import { DexieCloudSyncOptions } from "./DexieCloudSyncOptions";
import { Invite } from './Invite';
import { BehaviorSubject, Observable } from 'rxjs';
/** The API of db.cloud, where `db` is an instance of Dexie with dexie-cloud-addon active.
 */
export interface LoginHints {
    email?: string;
    userId?: string;
    grant_type?: 'demo' | 'otp';
    otpId?: string;
    otp?: string;
}
export interface DexieCloudAPI {
    version: string;
    options: DexieCloudOptions | null;
    schema: DexieCloudSchema | null;
    currentUserId: string;
    currentUser: BehaviorSubject<UserLogin>;
    webSocketStatus: BehaviorSubject<DXCWebSocketStatus>;
    syncState: BehaviorSubject<SyncState>;
    persistedSyncState: BehaviorSubject<PersistedSyncState | undefined>;
    events: {
        syncComplete: Observable<void>;
    };
    userInteraction: BehaviorSubject<DXCUserInteraction | undefined>;
    invites: Observable<Invite[]>;
    roles: Observable<{
        [roleName: string]: DBRealmRole;
    }>;
    usingServiceWorker?: boolean;
    isServiceWorkerDB?: boolean;
    /** Login using Dexie Cloud OTP or Demo user.
     *
     * @param email Email to authenticate
     * @param userId Optional userId to authenticate
     * @param grant_type requested grant type
     */
    login(hint?: LoginHints): Promise<void>;
    logout(options?: {
        force?: boolean;
    }): Promise<void>;
    /**
     * Connect to given URL
     */
    configure(options: DexieCloudOptions): void;
    /** Trigger a sync
     *
     */
    sync(options?: DexieCloudSyncOptions): Promise<void>;
    /** Method that returns an observable of the available permissions of given
     * entity.
     *
     * @param entity Entity to check permission for
     */
    permissions<T extends {
        owner: string;
        realmId: string;
        table: () => string;
    }>(entity: T): Observable<PermissionChecker<T>>;
    /** Method that returns an observable of the available permissions of given
     * object and table name.
     *
     * @param obj Object retrieved from a dexie query
     * @param table Table name that the object was retrieved from
     */
    permissions<T>(obj: T, table: string): Observable<PermissionChecker<T, string>>;
}
